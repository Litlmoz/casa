data_json = {
  "data":[{"id":"1","type":"floorplans","attributes":{"layout":215003,"windows":{"window1":"","window2":"","window3":"","window4":"","window5":""},"flats":[{"floor":"4","stack":"33"}]}},{"id":"2","type":"floorplans","attributes":{"layout":215007,"windows":{"window1":2,"window2":2,"window3":"","window4":"","window5":""},"flats":[{"floor":"6","stack":"37"},{"floor":"7","stack":"37"},{"floor":"9","stack":"37"}]}},{"id":"3","type":"floorplans","attributes":{"layout":215011,"windows":{"window1":2,"window2":3,"window3":"","window4":"","window5":""},"flats":[{"floor":"11","stack":"03"}]}},{"id":"4","type":"floorplans","attributes":{"layout":215017,"windows":{"window1":"","window2":"","window3":"","window4":"","window5":""},"flats":[{"floor":"3","stack":"26"},{"floor":"7","stack":"26"},{"floor":"16","stack":"26"},{"floor":"8","stack":"26"}]}},{"id":"5","type":"floorplans","attributes":{"layout":215019,"windows":{"window1":"","window2":"","window3":"","window4":"","window5":""},"flats":[{"floor":"10","stack":"13"},{"floor":"11","stack":"13"},{"floor":"8","stack":"13"},{"floor":"5","stack":"13"}]}},{"id":"6","type":"floorplans","attributes":{"layout":215021,"windows":{"window1":2,"window2":2,"window3":"","window4":"","window5":""},"flats":[{"floor":"10","stack":"04"}]}},{"id":"7","type":"floorplans","attributes":{"layout":215027,"windows":{"window1":"","window2":"","window3":"","window4":"","window5":""},"flats":[{"floor":"10","stack":"14"}]}},{"id":"8","type":"floorplans","attributes":{"layout":215031,"windows":{"window1":2,"window2":1,"window3":1,"window4":"","window5":""},"flats":[{"floor":"9","stack":"39"}]}},{"id":"9","type":"floorplans","attributes":{"layout":215033,"windows":{"window1":"","window2":"","window3":"","window4":"","window5":""},"flats":[{"floor":"10","stack":"38"}]}},{"id":"10","type":"floorplans","attributes":{"layout":215051,"windows":{"window1":2,"window2":2,"window3":"","window4":"","window5":""},"flats":[{"floor":"12","stack":"06"}]}},{"id":"11","type":"floorplans","attributes":{"layout":215075,"windows":{"window1":3,"window2":"","window3":"","window4":"","window5":""},"flats":[{"floor":"18","stack":"28"},{"floor":"18","stack":"27"},{"floor":"5","stack":"27"},{"floor":"19","stack":"29"},{"floor":"5","stack":"42"},{"floor":"10","stack":"29"},{"floor":"8","stack":"28"},{"floor":"21","stack":"29"}]}},{"id":"12","type":"floorplans","attributes":{"layout":215075,"windows":{"window1":2,"window2":"","window3":"","window4":"","window5":""},"flats":[]}},{"id":"13","type":"floorplans","attributes":{"layout":215075,"windows":nil,"flats":[{"floor":"3","stack":"42"},{"floor":"4","stack":"42"},{"floor":"3","stack":"40"},{"floor":"10","stack":"43"},{"floor":"7","stack":"43"},{"floor":"10","stack":"42"},{"floor":"5","stack":"41"}]}},{"id":"14","type":"floorplans","attributes":{"layout":215075,"windows":{"window1":1,"window2":1,"window3":"","window4":"","window5":""},"flats":[{"floor":"9","stack":"28"},{"floor":"7","stack":"28"}]}},{"id":"15","type":"floorplans","attributes":{"layout":215075,"windows":{"window1":2,"window2":"","window3":"","window4":"","window5":""},"flats":[{"floor":"15","stack":"29"},{"floor":"7","stack":"29"},{"floor":"3","stack":"29"},{"floor":"18","stack":"29"},{"floor":"6","stack":"27"},{"floor":"10","stack":"27"},{"floor":"21","stack":"27"}]}},{"id":"16","type":"floorplans","attributes":{"layout":215077,"windows":nil,"flats":[{"floor":"10","stack":"02"},{"floor":"12","stack":"10"},{"floor":"9","stack":"02"},{"floor":"7","stack":"02"},{"floor":"3","stack":"10"}]}},{"id":"17","type":"floorplans","attributes":{"layout":215079,"windows":nil,"flats":[{"floor":"6","stack":"16"},{"floor":"5","stack":"16"},{"floor":"10","stack":"19"},{"floor":"8","stack":"19"},{"floor":"12","stack":"16"},{"floor":"7","stack":"16"}]}},{"id":"18","type":"floorplans","attributes":{"layout":215081,"windows":{"window1":2,"window2":"","window3":"","window4":"","window5":""},"flats":[{"floor":"3","stack":"44"},{"floor":"10","stack":"44"}]}},{"id":"19","type":"floorplans","attributes":{"layout":215085,"windows":nil,"flats":[{"floor":"4","stack":"18"},{"floor":"9","stack":"18"},{"floor":"5","stack":"18"},{"floor":"12","stack":"18"},{"floor":"7","stack":"18"}]}},{"id":"20","type":"floorplans","attributes":{"layout":215089,"windows":nil,"flats":[{"floor":"22","stack":"31"}]}},{"id":"21","type":"floorplans","attributes":{"layout":215089,"windows":{"window1":3,"window2":"","window3":"","window4":"","window5":""},"flats":[{"floor":"12","stack":"30"},{"floor":"18","stack":"30"},{"floor":"10","stack":"30"}]}},{"id":"22","type":"floorplans","attributes":{"layout":215089,"windows":{"window1":2,"window2":"","window3":"","window4":"","window5":""},"flats":[{"floor":"19","stack":"30"},{"floor":"11","stack":"30"},{"floor":"14","stack":"30"},{"floor":"21","stack":"30"},{"floor":"17","stack":"30"}]}},{"id":"23","type":"floorplans","attributes":{"layout":215089,"windows":{"window1":1,"window2":1,"window3":"","window4":"","window5":""},"flats":[{"floor":"12","stack":"31"},{"floor":"19","stack":"31"}]}},{"id":"24","type":"floorplans","attributes":{"layout":215091,"windows":{"window1":1,"window2":1,"window3":"","window4":"","window5":""},"flats":[{"floor":"23","stack":"23"},{"floor":"12","stack":"23"},{"floor":"4","stack":"23"},{"floor":"19","stack":"23"},{"floor":"16","stack":"23"},{"floor":"14","stack":"23"},{"floor":"11","stack":"23"},{"floor":"10","stack":"23"},{"floor":"21","stack":"23"}]}},{"id":"25","type":"floorplans","attributes":{"layout":215093,"windows":{"window1":3,"window2":"","window3":"","window4":"","window5":""},"flats":[{"floor":"6","stack":"24"},{"floor":"19","stack":"24"},{"floor":"23","stack":"24"},{"floor":"15","stack":"24"},{"floor":"20","stack":"24"},{"floor":"5","stack":"24"},{"floor":"10","stack":"24"},{"floor":"7","stack":"24"},{"floor":"9","stack":"24"}]}},{"id":"26","type":"floorplans","attributes":{"layout":215095,"windows":{"window1":2,"window2":"","window3":"","window4":"","window5":""},"flats":[{"floor":"8","stack":"21"},{"floor":"3","stack":"21"}]}},{"id":"27","type":"floorplans","attributes":{"layout":215097,"windows":{"window1":4,"window2":"","window3":"","window4":"","window5":""},"flats":[{"floor":"15","stack":"12"},{"floor":"25","stack":"12"},{"floor":"19","stack":"12"}]}},{"id":"28","type":"floorplans","attributes":{"layout":215099,"windows":{"window1":2,"window2":"","window3":"","window4":"","window5":""},"flats":[{"floor":"10","stack":"05"},{"floor":"9","stack":"05"},{"floor":"7","stack":"05"},{"floor":"6","stack":"05"}]}},{"id":"29","type":"floorplans","attributes":{"layout":215103,"windows":{"window1":2,"window2":1,"window3":"","window4":"","window5":""},"flats":[{"floor":"14","stack":"11"},{"floor":"11","stack":"11"},{"floor":"12","stack":"11"},{"floor":"8","stack":"11"}]}},{"id":"30","type":"floorplans","attributes":{"layout":263084,"windows":nil,"flats":[{"floor":"12","stack":"08"},{"floor":"9","stack":"08"}]}}]
}

floorplans_json = data_json[:data]
floorplans_json.each do |h|
  floorplan = Floorplan.create!(layout_id: h[:attributes][:layout], windows: h[:attributes][:windows])

  h[:attributes][:flats].each do |f|
    flat = Flat.find_by(floor: f[:floor], stack: f[:stack])
    flat.floorplan = floorplan
    flat.save
  end
end
